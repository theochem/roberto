jobs:
- job: 'Test Linux'
  pool:
    vmImage: 'Ubuntu-16.04'
  strategy:
    matrix:
      py36:
        ROBERTO_CONDA_PINNING="python 3.6"
      py37:
        ROBERTO_CONDA_PINNING="python 3.7"
    maxParallel: 2

  steps:
  - bash: echo "##vso[task.prependpath]$/{CONDA}/bin"
    displayName: Add conda to PATH

  - bash: sudo chown -R $USER ${CONDA}
    displayName: Take ownership of conda installation

  - bash: |
      export ROBERTO_CONDA_BASE_PATH=${CONDA}
      export CONDA_BLD_PATH=${HOME}/conda-bld
      export ROBERTO_CONDA_PINNING="python $(python.version)"
      python3 -m pip install . coverage codecov --user
      python3 -m coverage run --branch --source=roberto -m roberto robot
      python3 -m coverage report -m
      python3 -m coverage xml -i -o coverage_run.xml
    displayName: 'Install and test package'

- job: 'Test MacOSX'
  pool:
    vmImage: 'macOS-10.13'
  strategy:
    matrix:
      py36:
        ROBERTO_CONDA_PINNING="python 3.6"
      py37:
        ROBERTO_CONDA_PINNING="python 3.7"
    maxParallel: 2

  steps:
  - bash: echo "##vso[task.prependpath]$/{CONDA}/bin"
    displayName: Add conda to PATH

  - bash: sudo chown -R $USER ${CONDA}
    displayName: Take ownership of conda installation

  - bash: |
      export ROBERTO_CONDA_BASE_PATH=${CONDA}
      export CONDA_BLD_PATH=${HOME}/conda-bld
      export ROBERTO_CONDA_PINNING="python $(python.version)"
      python3 -m pip install . coverage codecov --user
      python3 -m coverage run --branch --source=roberto -m roberto robot
      python3 -m coverage report -m
      python3 -m coverage xml -i -o coverage_run.xml
    displayName: 'Install and test package'
